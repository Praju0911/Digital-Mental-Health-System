{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/vishalprajwal/Documents/mental-health/frontend/src/lib/firebase.js"],"sourcesContent":["import { initializeApp, getApps } from \"firebase/app\";\nimport { getAuth } from \"firebase/auth\";\nimport { getFirestore } from \"firebase/firestore\";\n\nconst firebaseConfig = {\n  apiKey: \"AIzaSyAE-k8r8F4II_5rBfTvh6BNzQDku7KE_Gg\",\n  authDomain: \"mental-health-87a9d.firebaseapp.com\",\n  projectId: \"mental-health-87a9d\",\n  storageBucket: \"mental-health-87a9d.firebasestorage.app\",\n  messagingSenderId: \"500649525001\",\n  appId: \"1:500649525001:web:60ff34cd3656aebcbe9dd8\",\n  measurementId: \"G-6EVCYEMBVS\"\n};\n\nlet app;\nif (!getApps().length) {\n  app = initializeApp(firebaseConfig);\n} else {\n  app = getApps()[0];\n}\n\nconst auth = getAuth(app);\nconst db = getFirestore(app);\n\nexport { app, auth, db };"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AACA;AAAA;AACA;AAAA;;;;AAEA,MAAM,iBAAiB;IACrB,QAAQ;IACR,YAAY;IACZ,WAAW;IACX,eAAe;IACf,mBAAmB;IACnB,OAAO;IACP,eAAe;AACjB;AAEA,IAAI;AACJ,IAAI,CAAC,IAAA,8KAAO,IAAG,MAAM,EAAE;IACrB,MAAM,IAAA,oLAAa,EAAC;AACtB,OAAO;IACL,MAAM,IAAA,8KAAO,GAAE,CAAC,EAAE;AACpB;AAEA,MAAM,OAAO,IAAA,wKAAO,EAAC;AACrB,MAAM,KAAK,IAAA,kLAAY,EAAC","debugId":null}},
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/vishalprajwal/Documents/mental-health/frontend/src/app/student/chat/%5BsessionId%5D/page.jsx"],"sourcesContent":["\"use client\";\nimport { useState, useEffect, useRef } from 'react';\nimport { auth, db } from '@/lib/firebase';\nimport { collection, addDoc, serverTimestamp, query, orderBy, onSnapshot, getDoc, doc, deleteDoc, where, getDocs } from 'firebase/firestore';\nimport { onAuthStateChanged } from 'firebase/auth';\nimport { useParams, useRouter } from 'next/navigation';\n\nexport default function ChatRoom() {\n  const [user, setUser] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const params = useParams();\n  const router = useRouter();\n  const sessionId = params.sessionId;\n  const messagesEndRef = useRef(null);\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, (currentUser) => {\n      if (currentUser) {\n        setUser(currentUser);\n      } else {\n        router.push('/login');\n      }\n    });\n    return () => unsubscribe();\n  }, [router]);\n\n  useEffect(() => {\n    if (!sessionId) return;\n    const messagesRef = collection(db, 'chatSessions', sessionId, 'messages');\n    const q = query(messagesRef, orderBy('timestamp'));\n    const unsubscribe = onSnapshot(q, (snapshot) => {\n      const msgs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));\n      setMessages(msgs);\n    });\n    return () => unsubscribe();\n  }, [sessionId]);\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  }, [messages]);\n\n  const handleSendMessage = async (e) => {\n    e.preventDefault();\n    if (newMessage.trim() === '' || !user || !sessionId) return;\n\n    const messageToSend = newMessage;\n    setNewMessage(''); // Clear input immediately\n\n    // 1. Save the message to Firestore\n    const messagesRef = collection(db, 'chatSessions', sessionId, 'messages');\n    await addDoc(messagesRef, {\n      text: messageToSend,\n      senderId: user.uid,\n      timestamp: serverTimestamp()\n    });\n\n    // 2. Send the message for AI analysis in the background\n    try {\n      const userDoc = await getDoc(doc(db, \"users\", user.uid));\n      const anonymousName = userDoc.exists() ? userDoc.data().anonymousName : 'AnonymousStudent';\n      \n      const apiUrl = process.env.NEXT_PUBLIC_BACKEND_API_URL || 'http://localhost:8000';\n      \n      // Fire-and-forget this request. We don't need to wait for it.\n      fetch(`${apiUrl}/api/analyze-message`, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          message: messageToSend,\n          sessionId: sessionId,\n          anonymousName: anonymousName,\n          studentId: user.uid // Pass the student's real UID for backend lookup\n        }),\n      });\n    } catch (error) {\n      console.error(\"Failed to send message for analysis:\", error);\n    }\n  };\n  \n  const handleEndChat = async () => {\n    if (!user || !sessionId) return;\n    try {\n      // Clean up the queue if the session is still there\n      const q = query(collection(db, \"chatQueue\"), where(\"sessionId\", \"==\", sessionId));\n      const querySnapshot = await getDocs(q);\n      if (!querySnapshot.empty) {\n        const chatQueueDoc = querySnapshot.docs[0];\n        await deleteDoc(doc(db, \"chatQueue\", chatQueueDoc.id));\n      }\n      // Redirect back to the safety of the dashboard\n      router.push('/student/dashboard');\n    } catch (error) {\n      console.error(\"Error ending chat:\", error);\n      router.push('/student/dashboard'); // Still navigate away on error\n    }\n  };\n\n  if (!user) return <p className=\"text-center mt-10\">Loading...</p>;\n\n  return (\n    <div className=\"flex flex-col h-screen bg-gray-100\">\n        <header className=\"bg-white p-4 shadow-md flex justify-between items-center\">\n            <h1 className=\"text-xl font-semibold\">Speaking with a Professional</h1>\n            <button \n              onClick={handleEndChat} \n              className=\"bg-red-500 text-white font-bold px-4 py-2 rounded-lg hover:bg-red-600 transition\"\n            >\n                End Chat\n            </button>\n        </header>\n        <main className=\"flex-1 overflow-y-auto p-4\">\n            <div className=\"space-y-4\">\n                {messages.map(msg => {\n                    const isSender = msg.senderId === user.uid;\n                    return (\n                        <div key={msg.id} className={`flex ${isSender ? 'justify-end' : 'justify-start'}`}>\n                            <div className={`p-3 rounded-xl max-w-xs lg:max-w-md ${isSender ? 'bg-blue-600 text-white rounded-br-none' : 'bg-gray-200 text-gray-800 rounded-bl-none'}`}>\n                                {msg.text}\n                            </div>\n                        </div>\n                    );\n                })}\n                <div ref={messagesEndRef} />\n            </div>\n        </main>\n        <footer className=\"bg-white p-4 border-t\">\n            <form onSubmit={handleSendMessage} className=\"flex\">\n                <input\n                    type=\"text\"\n                    value={newMessage}\n                    onChange={(e) => setNewMessage(e.target.value)}\n                    placeholder=\"Type your message...\"\n                    className=\"flex-1 p-2 border rounded-l-lg focus:ring-blue-500 focus:border-blue-500\"\n                />\n                <button type=\"submit\" className=\"px-4 py-2 bg-blue-500 text-white rounded-r-lg hover:bg-blue-600\">\n                    Send\n                </button>\n            </form>\n        </footer>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":"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","debugId":null}}]
}